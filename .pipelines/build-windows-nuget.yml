resources:
- repo: self

pool:
  name: Hosted VS2017
  demands: Cmd

steps:
- task: VisualStudioTestPlatformInstaller@1
  inputs:
    packageFeedSelector: 'nugetOrg' # Options: nugetOrg, customFeed, netShare
    versionSelector: 'latestStable' # Required when packageFeedSelector == NugetOrg || PackageFeedSelector == CustomFeed# Options: latestPreRelease, latestStable, specificVersion
    #testPlatformVersion: # Required when versionSelector == SpecificVersion
    #customFeed: # Required when packageFeedSelector == CustomFeed
    #username: # Optional
    #password: # Optional
    #netShare: # Required when packageFeedSelector == NetShare
- script: |
    CALL .scripts/restore.cmd
    CALL .scripts/build.cmd
    CALL .scripts/test.cmd
    CALL .scripts/package.cmd
  env:
    Tag: +$(Build.SourceVersion)
    nugetPath: $(Build.SourcesDirectory)\vowpalwabbit\.nuget\nuget.exe
    DebugBuildScripts: 1
  failOnStderr: true